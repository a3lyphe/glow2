<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
        "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
	<title>Manual Test: Glow Base Widget</title>
	
	<script type="text/javascript">
		// configure the manual test...
		window.conf = {
			base: '../../../../packages/',
			version: '@SRC@'
		};
	</script>
	
	<script type="text/javascript" src="../../lib/manualtest.js"></script>
	<link type="text/css" rel="stylesheet" media="screen" href="../../lib/style.css" />
	
	<script type="text/javascript">
		// start glow loading
		window.glow = Glow(conf.version, {base: conf.base, debug: true});
	</script>
	
	<style type="text/css" media="screen">
		#counter {
			border: 1px solid gray;
			width: 180px;
		}
	</style>
</head>

<body>
	<h1>Glow Base Widget</h1>
	
	<h2>Synced Widgets</h2>
	
	<p id="counter"></p>

	<script type="text/javascript">
	i18n = {
		en: {
			LABEL_UP:   'Increase.',
			LABEL_DOWN: 'Decrease.'
		},
		pirate: {
			LABEL_UP:   'Up ye go, Arr!',
			LABEL_DOWN: 'Down ye go, Arr!'
		}
	};
	i18n.getLocalPack = function(locale) {
		if (!i18n[locale]) { locale = 'en'; }
		return i18n[locale];
	}
	i18n.getLocaleName = function() {
		return 'en';
	}
	

	
	
	
	
		
		module('Window Events');
		
		test('Widgets stay in sync.', function(result) {
			glow.load('widgets').ready(function() {
			
				function Label() {
					this.on('init', function(e) {
						this.caption = e.opts.caption;
						this.captions = i18n.getLocalPack(i18n.getLocaleName());
					});
					
					this.on('render', function(e) {
						this.container.html(this.captions[this.caption]);
					});
					
					this.on('locale', function(e) {
						this.captions = i18n.getLocalPack(e.localeName);
						if (this.rendered) { this.render(); }
					});
					
					this.on('disable', function(e) {
						if (e.disabled) { this.container.css('color', '#aaa'); }
						else { this.container.css('color', '#000'); }
					});
				}
				glow.util.extend(Label, glow.widgets.Widget);
				
				
				function UpDownWidget() {
					var label = new Label();
					this.sync(label);
					
					this.on('init', function(e) {
						label.init(e.opts);
					});
					
					this.on('bind', function(e) {
						var el = document.createElement('DIV');
						label.bind(el);

						e.container.append(label.container);
					});
					
					this.on('render', function(e) {
						label.render();
					});
					
					this.on('locale', function(e) {
						if (this.rendered) { this.render(); }
					});
				}
				glow.util.extend(UpDownWidget, glow.widgets.Widget);
				
				
				
				var myWidget = new UpDownWidget()
					.init({caption: 'LABEL_DOWN'})
					.bind('#counter');
				
				setTimeout(function() {
					myWidget.render();
				}, 1000);
				
				setTimeout(function() {
					myWidget.locale('pirate');
				}, 2000);
				
				setTimeout(function() {
					myWidget.disable();
				}, 3000);
				
				setTimeout(function() {
					myWidget.enable();
				}, 4000);
				
				setTimeout(function() {
					myWidget.locale('en');
				}, 5000);
		
			
/*			
			
			
			
			
			
			
			
			
			
				
				// a kind of widget can be synced
				function MyWidget(name) {
					this.name = name;
					this.value = 0; // initially
					
					// my widget can hadle notifications from widgets it is syced to
					var that = this;
					this.on('notify', function(e) {
						if (typeof e.newValue !== undefined) {
							that.value = e.newValue;
						}
					});
					
					this.on('initialized', function(e) {
						console.log('initialized '+that.name+' with opts: '+e.opts);
					});
					
					this.on('rendered', function(e) {
						console.log('rendered '+that.name+'.');
					});
					
					this.on('destroyed', function(e) {
						console.log('destroyed '+that.name+'.');
					});
					
					this.on('localeChanged', function(e) {
						console.log('updating '+that.name+'\'s locale to ' + e.localeName);
						that.render();
					});
					
					//call the base class's constructor
					arguments.callee.base.apply(this, arguments);
					
					this.init(arguments);
					this.bind();
					this.render();
					this.destroy();
				}
				glow.util.extend(MyWidget, glow.widgets.Widget); // MyWidget extends the Base Widget
				
				MyWidget.prototype.init = function(args) {
					console.log('init init: '+this.name+'.');
					this.constructor.base.prototype.init.apply(this, args);
				}
				
				MyWidget.prototype.render = function(n) {
					console.log('render render: '+this.name+'.');
					this.constructor.base.prototype.render.apply(this);
				}
				
				MyWidget.prototype.setValue = function(n) {
					this.value = n;
					
					// my widget announces changes to its value
					this.notify({newValue: this.value});
				}
				
				// widgets b and c will all be notified when a's value changes
				var a = new MyWidget('A');
				var b = new MyWidget('B');
				var c = new MyWidget('C');
				
				a.sync(b, c);
				
				
				
				console.log('0. a.localeName is '+a.localeName); // en-US
				console.log('0. b.localeName is '+b.localeName); // en-US
				console.log('0. c.localeName is '+c.localeName); // en-US
				
				a.locale('cy');
				
				console.log('0.1 a.localeName is '+a.localeName); // en-US
				console.log('0.1 b.localeName is '+b.localeName); // en-US
				console.log('0.1 c.localeName is '+c.localeName); // en-US
				
				console.log('--------');
				
				a.setValue(1); // a, b, and c all have a value of 1 now

				console.log('1. a.value is '+a.value); // 1
				console.log('1. b.value is '+b.value); // 1
				console.log('1. c.value is '+c.value); // 1
				
				a.setValue(7);
				
				console.log('2. a.value is '+a.value); // 7
				console.log('2. b.value is '+b.value); // 7
				console.log('2. c.value is '+c.value); // 7
				
				b.setValue(42);
				
				console.log('3. a.value is '+a.value); // 7
				console.log('3. b.value is '+b.value); // 42
				console.log('3. c.value is '+c.value); // 7
				
				a.disable();
				console.log('4. a.disabled is '+a.disabled); // true
				console.log('4. b.disabled is '+b.disabled); // true
				console.log('4. c.disabled is '+c.disabled); // true
				
				a.enable();
				console.log('5. a.disabled is '+a.disabled); // false
				console.log('5. b.disabled is '+b.disabled); // false
				console.log('5. c.disabled is '+c.disabled); // false
				
				b.disable();
				console.log('6. a.disabled is '+a.disabled); // false
				console.log('6. b.disabled is '+b.disabled); // true
				console.log('6. c.disabled is '+c.disabled); // false
*/				
			});
		});
	</script>
</body>
</html>