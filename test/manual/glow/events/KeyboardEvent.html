<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
        "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
	<title>Manual Test: Glow KeyboardEvent</title>
	
	<script type="text/javascript">
		// configure the manual test...
		window.conf = {
			base: '../../../../packages/',
			version: '@SRC@'
		};
	</script>
	
	<script type="text/javascript" src="../../lib/manualtest.js"></script>
	<link type="text/css" rel="stylesheet" media="screen" href="../../lib/style.css" />
	<script type="text/javascript" src="../../lib/log4javascript.js"></script>
	
	<script type="text/javascript">
		// set up logging...
		window.log = log4javascript.getDefaultLogger();
	</script>
	
	<script type="text/javascript">
		// start glow loading
		window.glow = Glow(conf.version, {base: conf.base, debug: true});
	</script>
</head>

<body>
	<h1>Glow KeyboardEvent</h1>
	
	<p>
		Key events fire in the right order for a quick alphanumeric key press
	</p>
	
	<div class="testarea">
		<div id="instruction">Click here to begin the test</div>
		<div id="endKeyTest">Click here to end the test</div>
		<textarea></textarea>
	</div>
	<script type="text/javascript">(function() {
		module('Key event order');
		
		var keysToTest = 'abc123'.split('').concat([
				'backspace', 'tab', 'return', 'shift', 'control', 'alt', 'escape',
				'space', 'pageup', 'pagedown', 'end', 'home', 'left', 'up', 'right', 'down',
				'insert', 'delete', ';', '=', '-', '`', '1 (numpad)', '2 (numpad)', '3 (numpad)', '4 (numpad)', '5 (numpad)',
				'6 (numpad)', '7 (numpad)', '8 (numpad)', '9 (numpad)', '0 (numpad)', 'f1', 'f2',
				'f3', 'f4', 'f5', 'f6', 'f7', 'f8', 'f9', 'f10', 'f11', 'f12', 'numlock', 'scrolllock', 'pause', ',', '.',
				'/', "'", '[', '\\', ']'
			]);
		
		var testActive,
			results = [],
			testInstructions = [],
			testIndex = -1,
			testNames,
			expectedKey,
			expectMultipleKeyPress, // for testing keyboard repeating
			instructionElm,
			keydownCount, keypressCount, keyupCount;
		
		function moveToNextTest() {
			testActive = true;
			testIndex++;
			// we run 2 test groups on each key, one for pressing and one for holding
			expectedKey = keysToTest[ testIndex ].replace(/\s+.*/, '');//keysToTest[ Math.floor(testIndex / 2) ];
			// we're looking for keyboard repeating on the odd numbered test groups
			//expectMultipleKeyPress = testIndex % 2;
			instructionElm.text(testInstructions[testIndex] + ' (click to move to next test)');
			keydownCount = 0;
			keypressCount = 0;
			keyupCount = 0;
		}
		
		glow.ready(function() {
			instructionElm = new glow.NodeList('#instruction').on('click', moveToNextTest);
		});
		
		
			
		for (var i = 0, leni = keysToTest.length; i < leni; i++) {
			testInstructions.push('Press ' + keysToTest[i] + ' briefly');
			results.push( test(keysToTest[i] + ' keydown (press)') );
			results.push( test(keysToTest[i] + ' keypress (press)') );
			results.push( test(keysToTest[i] + ' keyup (press)') );
			
			/*testInstructions.push('Hold ' + keysToTest[i] + ' for a second');
			results.push( test(keysToTest[i] + ' keydown (hold)') );
			results.push( test(keysToTest[i] + ' keypress (hold)') );
			results.push( test(keysToTest[i] + ' keyup (hold)') );*/
		}
		
		glow.ready(function() {
			new glow.NodeList(document).on('keydown', function(e) {
				if (testActive) {
					keydownCount++;
					
					results[testIndex * 3].ok(keypressCount === 0 && keyupCount === 0 && keydownCount === 1 && e.key === expectedKey, {
						keydownCount: keydownCount,
						keyCode: e.nativeEvent.keyCode,
						charCode: e.nativeEvent.charCode,
						key: e.key 
					});
				}
			}).on('keypress', function(e) {
				if (testActive) {
					keypressCount++;
					var pass = keyupCount === 0 && keydownCount > 0 && e.key === expectedKey;
					
					if (expectMultipleKeyPress) {
						pass = pass && keypressCount > 1;
					}
					else {
						pass = pass && keypressCount === 1;
					}
					
					results[(testIndex * 3) + 1].ok(pass, {
						keypressCount: keypressCount,
						keyCode: e.nativeEvent.keyCode,
						charCode: e.nativeEvent.charCode,
						key: e.key 
					})
					
					return false;
				}
			}).on('keyup', function(e) {
				if (testActive) {
					keyupCount++;
					results[(testIndex * 3) + 2].ok(keypressCount > 0 && keyupCount === 1 && keydownCount > 0 && e.key === expectedKey, {
						keyupCount: keyupCount,
						keyCode: e.nativeEvent.keyCode,
						charCode: e.nativeEvent.charCode,
						key: e.key 
					});
					moveToNextTest();
				}
			});
		});
		
		test('Test end', function(result) {
			glow.ready(function() {
				new glow.NodeList('#endKeyTest').on('click', function() {
					testActive = false;
					result.pass();
				});
			});
		});
	})()</script>

	<script type="text/javascript">
		// make scripts visible in the page...
		manualTests.showSrc();
	</script>
</body>
</html>