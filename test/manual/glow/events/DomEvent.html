<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
        "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
	<title>Manual Test: Glow DomEvent</title>
	
	<script type="text/javascript">
		// configure the manual test...
		window.conf = {
			base: '../../../../packages/',
			version: '@SRC@'
		};
	</script>
	
	<script type="text/javascript" src="../../lib/manualtest.js"></script>
	<link type="text/css" rel="stylesheet" media="screen" href="../../lib/style.css" />
	<script type="text/javascript" src="../../lib/log4javascript.js"></script>
	
	<script type="text/javascript">
		// set up logging...
		(function () {
			var log4jsLog,
				logOutputElementId = "log-messages";
			
			if (logOutputElementId) { // in-page log
				log4jsLog = log4javascript.getLogger("main");
				log4jsLog.addAppender(new log4javascript.InPageAppender(logOutputElementId));
			}
			else { // use pop-up window
				log4jsLog = log4javascript.getDefaultLogger();
			}
			
			// exports
			window.log = log4jsLog;
		})();
	</script>
	
	<script type="text/javascript">
		// start glow loading
		window.glow = Glow(conf.version, {base: conf.base, debug: true});
	</script>
</head>

<body>
	<h1>Glow DomEvent</h1>
	
	<p>
		The DomEvent module handles events attached to windows as well.
	</p>
	
	<div class="testarea" id="window-test">
		Resize the window.<br>
		Scroll the window.<br>
		<iframe name="iframe-test" id="iframe-test" src="iframe.html" width="220" height="80" scrolling="auto" frameborder="1" ></iframe>
	</div>
	<script type="text/javascript">
		module('Window Events');
		
		test('Window resize can be detected', function(result) {
			window.resizeCounter = 0;
			glow.ready(function() {
				new glow.NodeList(window).on('resize', function(e) {
					resizeCounter++;
					result.ok(true, {
						'resizeCounter': resizeCounter
					});
				})
			});
		});
		
		test('Multiple callbacks can run on resize', function(result) {
			window.resizeCounter2 = 0;
			glow.ready(function() {
				new glow.NodeList(window).on('resize', function(e) {
					resizeCounter2++;
					result.ok(resizeCounter === resizeCounter2, {
						'resizeCounter2': resizeCounter2
					});
				})
			});
		});
		
		test('Window scroll can be detected', function(result) {
			glow.ready(function() {
				new glow.NodeList(window).on('scroll', function(e) {
					result.pass(e);
				});
			});
		});
		
		test('Frame window load can be detected', function(result) {
			glow.ready(function() {
				new glow.NodeList('#iframe-test').on('load', function(e) {
					result.pass(e);
				});
			});
		});
		
		test('Frame window unload can be detected', function(result) {
			glow.ready(function() {
				new glow.NodeList(window.frames['iframe-test']).on('unload', function(e) {
					result.pass(e);
				});
			});
		});
	</script>

	<p>
		Mouse events, thier coordinates and their related elements can be detected. Moving the mouse
		very quickly may cause unexpected related elements to be returned, but that is unavoidable.
	</p>
	
	<div id="mouse-around" style="padding:20px">
		<div class="testarea" id="mouse-test">
			Move the mouse over me. Move mouse around a bit. Move the mouse off of me.
		</div>
	</div>
	
	<script type="text/javascript">
		module('Mouse over/out');
		
		test('Mouseover & related element can be detected', function(result) {
			glow.ready(function() {
				new glow.NodeList('#mouse-test').on('mouseover', function(e) {
					result.ok(e.related && e.related.id === 'mouse-around', {
						top: e.mouseTop,
						left: e.mouseLeft,
						related: e.related && (e.related.id || e.related.nodeName)
					});
				})
			});
		});
		
		test('Mousemove can be detected', function(result) {
			glow.ready(function() {
				new glow.NodeList('#mouse-test').on('mousemove', function(e) {
					result.pass({
						top: e.mouseTop,
						left: e.mouseLeft
					});
				});
			});
		});
		
		test('Mouseout & related element can be detected', function(result) {
			glow.ready(function() {
				new glow.NodeList('#mouse-test').on('mouseout', function(e) {
					result.ok(e.related && e.related.id === 'mouse-around', {
						top: e.mouseTop,
						left: e.mouseLeft,
						related: e.related && (e.related.id || e.related.nodeName)
					});
				})
			});
		});
	</script>
	
	
	
	<p class="testarea">
		<span id="click-test">Click on me.</span><br>
		<a id="click-test2" href="#zap">Click on me too.</a>
	</p>
	
	<script type="text/javascript">
		module('Click');
		
		test('Click on a span can be detected', function(result) {
			glow.ready(function() {
				new glow.NodeList('#click-test').on('click', function(e) {
					result.ok(this.id == 'click-test' && (e.source && e.source.id === 'click-test'), {
						id: this.id,
						'source id': e.source && e.source.id
					});
				})
			});
		});
		
		test('Mousedown on a span can be detected', function(result) {
			glow.ready(function() {
				new glow.NodeList('#click-test').on('mousedown', function(e) {
					result.pass({
						top: e.mouseTop,
						left: e.mouseLeft
					});
				})
			});
		});
		
		test('Mouseup on a span can be detected', function(result) {
			glow.ready(function() {
				new glow.NodeList('#click-test').on('mousedown', function(e) {
					result.pass({
						top: e.mouseTop,
						left: e.mouseLeft
					});
				})
			});
		});
		
		test('Click on a link can be detected', function(result) {
			glow.ready(function() {
				new glow.NodeList('#click-test2').on('click', function(e) {
					result.pass({
						top: e.mouseTop,
						left: e.mouseLeft
					});
				})
			});
		});
		
		test('Click on a link can be cancelled', function(result) {
			glow.ready(function() {
				new glow.NodeList('#click-test2').on('click', function(e) {
					setTimeout (function() {
						result.ok(window.location.hash !== '#zap', {
							'location hash': window.location.hash
						});
					}, 50);
					return false;
				})
			});
		});
	</script>
	
	
	<p>
		Glow supports events such as doubleclick and can detect modifier keys used with other events.
	</p>
	
	<p class="testarea">
		<span id="dblclick-test">Double-click me.</span><br>
		<span id="shiftclick-test">Shift-click me.</span><br>
		<span id="shiftaltclick-test">Shift-alt-click me.</span>
	</p>
	
	<script type="text/javascript">
		module('Dblclick & modifiers');
		
		test('Double-click on a span can be detected.', function(result) {
			glow.ready(function() {
				new glow.NodeList('#dblclick-test').on('dblclick', function(e) {
					result.pass({
						top: e.mouseTop,
						left: e.mouseLeft
					});
				});
			});
		});
		
		test('Shift-click on a span can be detected.', function(result) {
			glow.ready(function() {
				new glow.NodeList('#shiftclick-test').on('click', function(e) {
					result.ok(e.shiftKey && !e.altKey, {
						'e.shiftKey': e.shiftKey,
						'e.altKey': e.altKey
					})
				});
			});
		});
		
		test('Shift-alt-click on a span can be detected.', function(result) {
			glow.ready(function() {
				new glow.NodeList('#shiftaltclick-test').on('click', function(e) {
					result.ok(e.shiftKey && e.altKey, {
						'e.shiftKey': e.shiftKey,
						'e.altKey': e.altKey
					})
				});
			});
		});
	</script>
	
	<p>
		This tests the ability of Glow to keep multiple nodes and multiple event callbacks sorted.
	</p>
	
	<form action="#" method="get" class="testarea">
		<p>
			<input name="test-check1" id="test-check1" type="checkbox" value="check me"> <label for="test-check1">Click me.</label>
		</p>
		<p>
			<input name="test-check2" id="test-check2" type="checkbox" value="check me"> <label for="test-check2">Then click me</label>
		</p>
	</form>
	
	<script type="text/javascript">
		module('Multiple elements');
		
		test('Multiple elements can have a callback attached', function(result) {
			glow.ready(function() {
				var check1Clicked = false;
				
				new glow.NodeList('#test-check1, #test-check2').on('click', function(e) {
					if (this.id == 'test-check2') {
						result.ok(check1Clicked, {
							check1Clicked: check1Clicked
						});
					}
					else if (this.id == 'test-check1') {
						check1Clicked = true;
					}
				});
			});
		});
		
		test('Multiple elements can have a callback attached (another callback)', function(result) {
			glow.ready(function() {
				var check1Clicked = false;
				
				new glow.NodeList('#test-check1, #test-check2').on('click', function(e) {
					if (this.id == 'test-check2') {
						result.ok(check1Clicked, {
							check1Clicked: check1Clicked
						});
					}
					else if (this.id == 'test-check1') {
						check1Clicked = true;
					}
				});
			});
		});
	</script>
	
	
	<p>
		Form specific events, and keystroke-based events.
	</p>
	
	<form action="#" method="get" class="testarea" name="test-form" id="test-form">
		<p>
			<input name="test-text" id="test-text" type="text"> <label for="test-text">Type in me.</label>
		</p>
		<p>
			<input name ="myreset" id="myreset" type="reset"> <label for="myreset">Reset me.</label>
		</p>
		<p>
			<input name="mysubmit" id="mysubmit" type="submit"> <label for="mysubmit">Then submit me.</label>
		</p>
	</form>
	
	<script type="text/javascript">
		module('Form fields');
		
		test('Focus on an element can be detected.', function(result) {
			glow.ready(function() {
				new glow.NodeList('#test-text').on('focus', function(e) {
					result.pass();
				});
			});
		});
		
		test('Change on an element can be detected.', function(result) {
			glow.ready(function() {
				new glow.NodeList('#test-text').on('change', function(e) {
					result.pass();
				});
			});
		});
		
		test('Blur on an element can be detected.', function(result) {
			glow.ready(function() {
				new glow.NodeList('#test-text').on('blur', function(e) {
					result.pass();
				});
			});
		});
		
		test('Focus bubbles to form', function(result) {
			glow.ready(function() {
				new glow.NodeList('#test-form').on('focus', function(e) {
					result.pass();
				});
			});
		});
		
		test('Change bubbles to form', function(result) {
			glow.ready(function() {
				new glow.NodeList('#test-form').on('change', function(e) {
					result.pass();
				});
			});
		});
		
		test('Blur bubbles to form', function(result) {
			glow.ready(function() {
				new glow.NodeList('#test-form').on('blur', function(e) {
					result.pass();
				});
			});
		});
		
		test('Reset on form can be detected.', function(result) {
			glow.ready(function() {
				new glow.NodeList('#test-form').on('reset', function(e) {
					result.pass();
				});
			});
		});
		
		test('Submit on form can be detected.', function(result) {
			glow.ready(function() {
				new glow.NodeList('#test-form').on('submit', function(e) {
					result.pass();
				});
			});
		});
	</script>

	<p>
		Scroll event.
	</p>
	
	<div class="testarea" id="scroll-test" style="height: 60px; width: 100px; overflow-y: scroll;">
		<div style="height: 120px;">Scroll me.</div>
	</div>
	
	<script type="text/javascript">
		module('Scrolling');
		
		test('Focus on an element can be detected.', function(result) {
			glow.ready(function() {
				new glow.NodeList('#scroll-test').on('scroll', function(e) {
					result.pass()
				});
			});
		});
	</script>

	<script type="text/javascript">
		// make scripts visible in the page...
		manualTests.showSrc();
	</script>
	
	<p><a name="zap">oops, did you get sent here from a test?</a></p>
</body>
</html>