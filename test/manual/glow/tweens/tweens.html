<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-GB" lang="en-GB">
<head profile="http://dublincore.org/documents/dcq-html/">

	<title>Tweens</title>

	<script src="../../../unit/lib/testhelper.js?base=../../../../" type="text/javascript"></script>
	
	<script type="text/javascript">
		testHelper.addScript('glow.js');
	</script>
	
	<script type="text/javascript" src="../../lib/manualtest.js"></script>
	<link type="text/css" rel="stylesheet" media="screen" href="../../lib/style.css" />

<style type="text/css">
	#graph, #motion {
		height: 500px;
		width: 530px;
		border: 1px solid #000;
		margin-bottom: 10px;
		position: relative;
	}
	#graph, #tweenApp canvas {
		background: url(graphbg.gif) no-repeat center;
	}
	#graph {
		position: absolute;
	}
	div.graphDot {
		width: 2px;
		height: 2px;
		overflow: hidden;
		background: #900;
		position: absolute;
	}
	#motionTest {
		width: 37px;
		height: 37px;
		background: url(ball.png);
		position: absolute;
	}
	#tweenApp label {
		display: block;
	}
	#tweenApp input.text {
		width: 150px;
	}
	#tweenApp {
		overflow: hidden;
		zoom: 1;
		border-top: 1px solid #ccc;
		padding-top: 10px;
	}
	#tweenApp div.leftCol {
		float: left;
		display: inline;
		width: 200px;
	}
	#tweenApp div.rightCol {
		margin-left: 230px;
		zoom: 1;
	}
	#tweenApp div.cols {
		overflow: hidden;
		zoom: 1;
	}
	#tweenApp div.rightCol p {
		margin-bottom: 0;
	}
	#content #tweenApp p {
		width: auto;
	}
	pre.prettyprint {
		overflow: scroll; 
		width: 400px;
	}
</style>

<!--[if lte IE 6]>
  <style type="text/css">
    #motionTest {
      background: none;
      filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(src='ball.png', sizingMethod='crop');
    }
  </style>
<![endif]-->


</head>
<body>

<div id="glow-version"></div>

<div id="tweenApp">
	<div class="leftCol">
		<h2>Tween to view</h2>
		<h3>Available tweens</h3>
		<ul id="tweenList">
			<li></li>
		</ul>

		<h3>View Tween</h3>
		<form id="tweenSelection" action="">
			<p><label for="tweenFunc">Tween function: </label><input type="text" class="text" value="glow.tweens.linear()" id="tweenFunc" /><input type="submit" value="View" /></p>
			<p><label for="duration">Duration: </label><input type="text" class="text" value="2" id="duration" /></p>
		</form>
		<h3>Combine Tweens</h3>
		<form id="tweenCombination" action="">

			<p><label for="tweenStart">Start Tween: </label><input type="text" class="text" value="glow.tweens.linear()" id="tweenStart" /></p>
			<p><label for="tweenEnd">End Tween: </label><input type="text" class="text" value="glow.tweens.linear()" id="tweenEnd" /></p>
			<p><input type="submit" value="Combine" /></p>
		</form>
	</div>
	<div class="rightCol">
		<h2>The Tween</h2>

		<p>This is a graph of the tween selected above. Click within the graph to see how it animates.</p>
		<div id="graph"></div>
		<div id="motion"><div id="motionTest"></div></div>
	</div>
</div>


		</div>
		<div class="bl"><div class="br"></div></div>
	</div>


	</div>

<script>
 var glow = Glow( testHelper.getVersion(), {base: testHelper.getBase() });
 glow.load("core");
 glow.loaded(function() {
	console.log("ready");
	var $ = glow;
	var graphRes = 0.001;
	var animRes = 0.01;
	var graph = $("#graph");
	var canvas = $("#motion");
	var motionElm = $("#motionTest");
	var tweenList = $("#tweenList");
	var tweenFuncField = $("#tweenFunc");
	var startTweenField = $("#tweenStart");
	var endTweenField = $("#tweenEnd");
	var durationField = $("#duration"); var dot = $('<div class="graphDot"></div>');
	var r;
	var html5canvas = $('<canvas id="graph"></canvas>');
	
	if (html5canvas[0] && html5canvas[0].getContext) {
		graphRes = 0.0003;
		graph.remove(); html5canvas.insertBefore(canvas);
	} else {
		html5canvas = undefined;
	}

	 if (r = /tween=([^&;]+)/.exec(window.location.search)) {
		var funcStr = decodeURI(r[1]);
		tweenFuncField.val(funcStr);
		showGraphFor(funcStr);
	} else {
		var tweenFunc = glow.tweens.linear();
	}

	tweenList.empty();

	for (var tween in glow.tweens) { if (tween == "combine") { continue; }
		tweenList.append('<li><a href="#">glow.tweens.' + tween + '</a></li>');
	}

	tweenList.on("click", function(event) {
		if (event.source.parentNode.href) { //safari 1.3 bug, we should fix this
			event.source = event.source.parentNode;
		}
		
		if (event.source.href) {
			tweenFuncField.val($(event.source).text() + "()");
			showGraphFor($(event.source).text() + "()");
			return false;
		}
	})

	$("#tweenSelection").on("submit", function() {
		showGraphFor(tweenFuncField.val());
		return false;
	});

	$("#tweenCombination").on("submit", function() {
		var funcStr = "glow.tweens.combine(" + startTweenField.val() + ", " + endTweenField.val() + ")";
		tweenFuncField.val(funcStr);
		showGraphFor(funcStr);
		return false;
	});

	/*glow.events.addListener(canvas, "click", function(event) {
		moveTo(event.pageX, event.pageY);
	});*/

	function showGraphFor(func) {
		if (typeof func == "string") {
			try {
				tweenFunc = eval(func);
			} catch(e) {
				alert("Syntax error");
			return false;
			}
		} else {
			tweenFunc = func;
		}
 
		if (html5canvas) {
			var context = html5canvas[0].getContext('2d');
			html5canvas[0].width = "530";
			html5canvas[0].height = "500";
			context.fillStyle = "#900";
			
			for (var i = 0; i <= 1; i += graphRes) {
				context.fillRect((i * 410) + 60, 500 - ((tweenFunc(i).toFixed(8)) * 380 || 0) - 60, 2, 2);
			}
		} else {
			graph.empty();
			
			for (var i = 0; i <= 1; i += graphRes) {
				dot.clone().
				css("top", 500 - ((tweenFunc(i).toFixed(8) * 380) || 0) - 60 + "px").
				css("left", (i * 410) + 60 + "px").
				appendTo(graph);
			}
		}
	}

	var anim;

	function moveTo(x, y) {
	
	var offset = canvas.offset();
	
	//18 & 16 make it appear centred
	x -= offset.left + 18;
	y -= offset.top + 16;
	
	glow.anim.css(motionElm, parseFloat(durationField.val()), {
		left: {to: x},
		top: {to: y}
	}, {tween:tweenFunc}).start();
 }
 
});

 
 
</script>
</body>
</html>






















