<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
        "http://www.w3.org/TR/html4/strict.dtd">
<html lang="en">
<head>
	<meta http-equiv="content-type" content="text/html; charset=utf-8">
	<title>test: run all</title>
	
	<style type="text/css" media="screen">
	
		
		ol#runall-tests{
			font-family:"Helvetica Neue Light", "HelveticaNeue-Light", "Helvetica Neue", Calibri, Helvetica, Arial;
			margin:0;
			padding:0;
			list-style-position:inside;s    

			font-size: smaller;
		}
		a, a:hover, a:visited { color: #000; }
		ol#runall-tests li{
			padding:0.4em 0.5em 0.4em 2.5em;
			border-bottom:1px solid #fff;
			font-size:small;
			list-style-position:inside;
		}
		ol#runall-tests li div{
			display:inline;
		}
		ol#runall-tests li ol{
			box-shadow: inset 0px 2px 13px #999;
			-moz-box-shadow: inset 0px 2px 13px #999;
			-webkit-box-shadow: inset 0px 2px 13px #999;
			margin-top:0.5em;
			margin-left:0;
			padding:0.5em;
			background-color:#fff;
			border-radius:15px;
			-moz-border-radius: 15px;
			-webkit-border-radius: 15px;
		}    
		ol#runall-tests li.pass{
			background-color:#D2E0E6;
			color:#528CE0;
		}
		ol#runall-tests li.fail{
			background-color:#EE5757;
			color:#000;
		}
		
		h1{
			background-color:#0d3349;
			margin:0;
			padding:0.5em 0 0.5em 1em;
			color:#fff;
			font-family:"Helvetica Neue Light", "HelveticaNeue-Light", "Helvetica Neue", Calibri, Helvetica, Arial;
			border-top-right-radius:15px;
			border-top-left-radius:15px;
			-moz-border-radius-topright:15px;
			-moz-border-radius-topleft:15px;
			-webkit-border-top-right-radius:15px;
			-webkit-border-top-left-radius:15px;
			text-shadow: rgba(0, 0, 0, 0.5) 4px 4px 1px;
			border-bottom:4px solid #2b81af;
		}
		
		#qunit-testrunner-toolbar {
			font-family:"Helvetica Neue Light", "HelveticaNeue-Light", "Helvetica Neue", Calibri, Helvetica, Arial;
			padding:0;
			/*width:80%;*/
			padding:0em 0 0.5em 2em;
			font-size: small;
		}
		
		#runall-status{
			font-family:"Helvetica Neue Light", "HelveticaNeue-Light", "Helvetica Neue", Calibri, Helvetica, Arial;
			margin:0;
			font-size: small;
			color:#2b81af;
			border-bottom-right-radius:15px;
			border-bottom-left-radius:15px;
			-moz-border-radius-bottomright:15px;
			-moz-border-radius-bottomleft:15px;
			-webkit-border-bottom-right-radius:15px;
			-webkit-border-bottom-left-radius:15px;
			background-color:#D2E0E6;
			padding:0.5em 0.5em 0.5em 2.5em;
		}
		strong b.fail{
			color:#710909;
		}
		strong b.pass{
			color:#5E740B;
		}
		iframe{
			position: absolute;
    left: -9999em;
		}
	</style>
	
	<script type="text/javascript">
		var testpages = {
			glow: 'glow.html',
			attributes: 'NodeList/attributes.html',
			nodelist: 'NodeList/NodeList.html',
			manipulation: 'NodeList/manipulation.html',
			traversal: 'NodeList/traversal.html',
			appearance: 'NodeList/appearance.html',
			events: 'events/events.html',
			env: 'env/env.html'
		};
		
		var conf = {
			//debug: 'debug=true&'
		}
		
		function init() {
			window.harness = new Harness(testpages, conf);
			harness.openAll();
		}
		
		window.onload = init;
		
		
		function Harness(testpages, opts) {
			this.testpages = testpages;
			this.opts = opts || {};
			
			this.results = {};
			this.output = {};
			
			this.running = 0;
			this.timer = null;
		}
		
		Harness.prototype.openAll = function() {
			var location;
				
			for (var name in this.testpages) {
				src = this.testpages[name];
				
				var ol = document.getElementById('runall-tests');
				if (ol) {
					var li = document.createElement('LI');
					li.innerHTML = name + ':';
					ol.appendChild(li);
				}
				this.output[name] = li;
				
				this.running++;
				Harness.addFrame(name, src, this.opts);
			}
			
			var that = this;
			this.timer = setTimeout(function() { that.timesUp(); }, 30000);
		}
		
		Harness.prototype.result = function(name, failures, total) {
			this.running--;
			this.results[name] = { failures: failures, total: total };
			
			var status = '<a href="'+this.testpages[name]+'" target="_blank">'+this.testpages[name]+'<'+'/a>: <strong>(<b class="fail">'+failures+'<'+'/b>, <b class="pass">'+(total-failures)+'<'+'/b>, '+total+')<'+'/strong>';
			var className = (failures === 0)? 'pass' : 'fail';
			this.status(name, status, className);
				
			if (this.running === 0) {
				clearTimeout(this.timer);
				this.closeAll();
			}
		}
		
		Harness.prototype.status = function(name, message, className) {
			if (className) {
				this.output[name].className = className;
			}
			this.output[name].innerHTML = name + ': ' + message;
		}
		
		Harness.prototype.closeAll = function() {
			for (var name in this.testpages) {
				Harness.removeFrame(name);
			}
		}
		
		Harness.prototype.timesUp = function() {
			for (var name in this.testpages) {
				if (!this.results[name]) {
					this.results[name] = { failures: -1, total: -1 };
					var status = '<a href="'+this.testpages[name]+'" target="_blank">'+this.testpages[name]+'<'+'/a>: <strong>(<b class="fail">timed out<'+'/b>)<'+'/strong>';
					this.status(name, status, 'fail');
				}
			}
			
			this.closeAll();
		}
		
		/////////////
		
		Harness.addFrame = function(name, src, opts) {
			var iframe = document.createElement('IFRAME'),
				debug = opts? (opts.debug || '') : '';
			
			iframe.width = '200px';
			iframe.height = '200px';
			iframe.style.border = 'none';
			iframe.id = name;
			iframe.src = src + '?'+debug+'nocache='+new Date().getTime();
			
			document.body.appendChild(iframe);
			
			frames[frames.length-1].name = name;
		}
		
		Harness.removeFrame = function(name) {
			var frameElm = document.getElementById(name);
			frameElm.parentNode.removeChild(frameElm);
		}
		
		Harness.attach = function(name, unitTester) {
			unitTester.done = function (failures, total) {
				window.harness.result(name, failures, total);
			}
			unitTester.moduleStart = function(moduleName) {
				window.harness.status(name, 'module: '+moduleName);
			}
			unitTester.testStart = function(testName) {
				window.harness.status(name, 'running test: '+testName);
			}
		}
	</script>


</head>
<body>
	<h1 id="runall-header">Run All Tests: Glow 2</h1>
	<ol id="runall-tests"></ol>
	<ol id="runall-status"></ol>
</body>
</html>
